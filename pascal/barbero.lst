- Pascal-FC for IBM PC compatibles - 
- Compiler Version jc-0.9.40

G L Davies  &  A Burns, University of Bradford
J C Coppens, Universidad Católica de Córdoba

Compiler listing

    1     0 program barbero;
    2     0 
    3     0 var
    4     0     barberReady, availableWaitingRoomSeats, customersWaiting : semaphore;
    5     0     {}
    6     0     WRseats: integer;
    7     0     {}
    8     0 
    9     0 process type barber;
   10     0 begin
   11     0     while true do
   12     2     begin
   13     2         sleep(10);
   14     4         wait(customersWaiting);
   15     6         wait(availableWaitingRoomSeats);
   16     8         WRseats:= WRseats +1;
   17    13         signal(barberReady);
   18    15         signal(availableWaitingRoomSeats);
   19    17         writeln('Barbero va a atender');
   20    20         sleep(10);
   21    22 
   22    22     end;
   23    23     
   24    23 end;
   25    24     
   26    24 process type customer;
   27    24 var atendido,no_atendido : integer;
   28    24 begin
   29    24     atendido:=0;
   30    27     while atendido<>1 do
   31    31     begin
   32    31         sleep(10);
   33    33         wait(availableWaitingRoomSeats);
   34    35         if WRseats > 0 then
   35    39             begin
   36    39                 writeln('Llega cliente y se sienta');
   37    42                 WRseats:= WRseats - 1;
   38    47                 signal(customersWaiting);
   39    49                 signal(availableWaitingRoomSeats);
   40    51                 writeln('Cliente espera atencion');
   41    54                 wait(barberReady);
   42    56                 writeln('Cliente esta siendo atendido');
   43    59                 sleep(10);
   44    61                 writeln('Cliente termino de ser atendido y se va');
   45    64                 atendido:=Random(2);
   46    68                 sleep(10);
   47    70             end
   48    70         else begin
   49    71                 signal(availableWaitingRoomSeats);
   50    73                 writeln('Cliente no encontro asiento y se va');
   51    76                 sleep(10);
   52    78             end;
   53    78     end;
   54    79 end;
   55    80 
   56    80 var
   57    80     customers : array [1..7] of customer;
   58    80     barbershopOwner : barber;
   59    80     i,n : integer;        
   60    80 
   61    80 begin
   62    80     Randomize;
   63    81     WRseats:=5;
   64    84     initial(barberReady,0);
   65    88     initial(availableWaitingRoomSeats,1);
   66    92     initial(customersWaiting,0);
   67    96 
   68    96     cobegin;
   69    97         barbershopOwner;
   70   101         for i := 1 to 7 do
   71   105             customers[i];
   72   112     coend;
   73   113 
   74   113 end.


Symbol table

     link   object      type          ref  normal  lvl  adr  aux  name

 56    55   procedure   notyp           2    TRUE    0   80    0  _main
 57     0   variable    synch           0    TRUE    1    5    0  any
 58    57   variable    semaphore       0    TRUE    1    5    0  barberready
 59    58   variable    semaphore       0    TRUE    1    6    0  availablewaitingroomseats
 60    59   variable    semaphore       0    TRUE    1    7    0  customerswaiting
 61    60   variable    integer         0    TRUE    1    8    0  wrseats
 62    61   type id     process         3    TRUE    1    0    0  barber
 63    62   type id     process         4    TRUE    1   24    0  customer
 64     0   variable    integer         0    TRUE    2    5    0  atendido
 65    64   variable    integer         0    TRUE    2    6    0  no_atendido
 66    63   variable    array           1    TRUE    1    9    0  customers
 67    66   variable    process         3    TRUE    1   16    0  barbershopowner
 68    67   variable    integer         0    TRUE    1   17    0  i
 69    68   variable    integer         0    TRUE    1   18    0  n

Generated P-code

    0     ldcon.b      0         1 ; 11
    1     jmpiz        0        23 ; 11
    2     ldcon.i      0        10 ; 13
    3     sleap        0         0 ; 13
    4     ldadr        1         7 ; 14
    5     wait         0         0 ; 14
    6     ldadr        1         6 ; 15
    7     wait         0         0 ; 15
    8     ldadr        1         8 ; 15
    9     ldval.i      1         8 ; 16
   10     ldcon.i      0         1 ; 16
   11     add  .i      0         0 ; 16
   12     store.i      0         0 ; 16
   13     ldadr        1         5 ; 17
   14     signl        0         0 ; 17
   15     ldadr        1         6 ; 18
   16     signl        0         0 ; 18
   17     ldcon.i      0        20 ; 19
   18     wrstr        0         0 ; 19
   19     wrlin        0         0 ; 19
   20     ldcon.i      0        10 ; 20
   21     sleap        0         0 ; 20
   22     jmp          0         0 ; 20
   23     rproc        1         0 ; 22
   24     ldadr        2         5 ; 28
   25     ldcon.i      0         0 ; 29
   26     store.i      0         0 ; 29
   27     ldval.i      2         5 ; 30
   28     ldcon.i      0         1 ; 30
   29     relne.i      0         0 ; 30
   30     jmpiz        0        79 ; 30
   31     ldcon.i      0        10 ; 32
   32     sleap        0         0 ; 32
   33     ldadr        1         6 ; 33
   34     wait         0         0 ; 33
   35     ldval.i      1         8 ; 34
   36     ldcon.i      0         0 ; 34
   37     relgt.i      0         0 ; 34
   38     jmpiz        0        71 ; 34
   39     ldcon.i      0        25 ; 36
   40     wrstr        0        20 ; 36
   41     wrlin        0         0 ; 36
   42     ldadr        1         8 ; 36
   43     ldval.i      1         8 ; 37
   44     ldcon.i      0         1 ; 37
   45     sub  .i      0         0 ; 37
   46     store.i      0         0 ; 37
   47     ldadr        1         7 ; 38
   48     signl        0         0 ; 38
   49     ldadr        1         6 ; 39
   50     signl        0         0 ; 39
   51     ldcon.i      0        23 ; 40
   52     wrstr        0        45 ; 40
   53     wrlin        0         0 ; 40
   54     ldadr        1         5 ; 41
   55     wait         0         0 ; 41
   56     ldcon.i      0        28 ; 42
   57     wrstr        0        68 ; 42
   58     wrlin        0         0 ; 42
   59     ldcon.i      0        10 ; 43
   60     sleap        0         0 ; 43
   61     ldcon.i      0        39 ; 44
   62     wrstr        0        96 ; 44
   63     wrlin        0         0 ; 44
   64     ldadr        2         5 ; 44
   65     ldcon.i      0         2 ; 45
   66     stfun.i      0        19 ; 45
   67     store.i      0         0 ; 45
   68     ldcon.i      0        10 ; 46
   69     sleap        0         0 ; 46
   70     jmp          0        78 ; 47
   71     ldadr        1         6 ; 49
   72     signl        0         0 ; 49
   73     ldcon.i      0        35 ; 50
   74     wrstr        0       135 ; 50
   75     wrlin        0         0 ; 50
   76     ldcon.i      0        10 ; 51
   77     sleap        0         0 ; 51
   78     jmp          0        27 ; 52
   79     rproc        1         0 ; 53
   80     rndmiz        0         0 ; 61
   81     ldadr        1         8 ; 62
   82     ldcon.i      0         5 ; 63
   83     store.i      0         0 ; 63
   84     ldadr        1         5 ; 64
   85     ldcon.i      0         0 ; 64
   86     lobnd.i      0         0 ; 64
   87     sinit        0         0 ; 64
   88     ldadr        1         6 ; 65
   89     ldcon.i      0         1 ; 65
   90     lobnd.i      0         0 ; 65
   91     sinit        0         0 ; 65
   92     ldadr        1         7 ; 66
   93     ldcon.i      0         0 ; 66
   94     lobnd.i      0         0 ; 66
   95     sinit        0         0 ; 66
   96     cobeg        0         0 ; 66
   97     mrkst        1        62 ; 68
   98     ldadr        1        16 ; 68
   99     procv        0         0 ; 68
  100     calls        1         4 ; 68
  101     ldadr        1        17 ; 69
  102     ldcon.i      0         1 ; 70
  103     ldcon.i      0         7 ; 70
  104     for1u.i      0       112 ; 70
  105     mrkst        1        63 ; 70
  106     ldadr        1         9 ; 70
  107     ldval.i      1        17 ; 71
  108     ixary.i      0         1 ; 71
  109     procv        0         0 ; 71
  110     calls        1         4 ; 71
  111     for2u.i      0       105 ; 71
  112     coend        0         0 ; 71
  113     stop         0         0 ; 72
